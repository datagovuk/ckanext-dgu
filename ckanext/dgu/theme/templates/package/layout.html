<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >
  <?python
      if c.pkg_dict:
          # DGU sometimes provides no resources, just these three objects
          individual_resources = c.pkg_dict.get('individual_resources', [])
          timeseries_resources = c.pkg_dict.get('timeseries_resources', [])
          additional_resources = c.pkg_dict.get('additional_resources', [])

          # Hack. I cannot clearly tell why sometimes the resources are defined by the three keys (above)
          #   and other times defined by 'resources'. I think a plugin toggles it. Without this line,
          #   no resources are rendered by read_core.
          if not individual_resources and not timeseries_resources and not additional_resources:
              individual_resources = c.pkg_dict.get('resources', [])

          # Core CKAN expects a resource dict to render in the navigation
          if not 'resources' in c.pkg_dict:
              c.pkg_dict['resources'] = individual_resources + timeseries_resources + additional_resources

  ?>

  <py:match path="minornavigation" py:if="c.pkg">
    <ul class="nav nav-pills">
      <li class="${'active' if c.action=='read' else ''}">${h.subnav_link(c, h.icon('package') + _('View'), controller='package', action='read', id=c.pkg.name)}</li>
      <py:choose test="len(c.pkg_dict.get('resources', []))==0 and not h.check_access('package_update',{'id':c.pkg.id})">
      <py:when test="True">
        <li class="disabled">
          <a href="#" onclick="return false;">${h.icon('package-disabled') + _('Resources (0)')}</a>
        </li>
      </py:when>
      <py:otherwise>
        <li class="dropdown ${'active' if (c.action=='resource_read' or c.action=='editresources') else ''}">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">${h.icon('page_white_stack') + _('Resources') + ' (' + str(len(c.pkg_dict.get('resources',[]))) + ')'}<b class="caret"></b></a>
          <div class="dropdown-appears">
            <ul class="dropdown-menu">
              <li py:for="res in c.pkg_dict.get('resources', [])">
                <a href="${h.url_for(controller='package', action='resource_read', id=c.pkg_dict['name'], resource_id=res['id'])}">${h.resource_icon(res) + h.resource_display_name(res)}</a>
              </li>
            </ul>
          </div>
        </li>
      </py:otherwise>
      </py:choose>
      <li class="${'active' if c.action=='history' else ''}">${h.subnav_link(c, h.icon('page_stack') + _('History'), controller='package', action='history', id=c.pkg.name)}</li>
      <py:if test="h.check_access('package_update',{'id':c.pkg.id})">
        <li class="divider">|</li>
        <li class="${'active' if c.action=='edit' else ''}">
          ${h.subnav_link(c, h.icon('package_edit') + _('Edit'), controller='package', action='edit', id=c.pkg.name)}
        </li>
      </py:if>
      <li class="${'active' if c.action=='authz' else ''}" py:if="h.check_access('package_edit_permissions',{'id':c.pkg.id})">
        ${h.subnav_link(c, h.icon('lock') + _('Authorization'), controller='package', action='authz', id=c.pkg.name)}
      </li>
    </ul>
  </py:match>
  
  <xi:include href="../layout.html" />

</html>

